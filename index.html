<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Sumsimausi Task Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<style>
:root {
    --pink: #ff5fa2;
    --pink-dark: #e91e63;
    --pink-light: #ffe0ec;
    --white: #ffffff;
}

* {
    box-sizing: border-box;
}

body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    background: linear-gradient(180deg, #ffe0ec 0%, #ffffff 100%);
    background-repeat: no-repeat;
    background-attachment: fixed;
    min-height: 100vh;
    margin: 0;
    padding: 20px;
}

h1 {
    margin-bottom: 24px;
    color: var(--pink-dark);
    font-size: 28px;
    text-align: center;
}

.task-form {
    background: var(--white);
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(233,30,99,0.18);
    overflow: hidden;
    transition: max-height 0.4s ease, padding 0.4s ease;
    max-height: 50px;        /* minimized height */
    padding: 10px 20px;      /* show header */
    margin-bottom: 20px;
}

.task-form.expanded {
    max-height: 600px;       /* fully expanded */
    padding: 20px;
}

.task-form h3 {
    margin: 0;
    font-size: 20px;
    cursor: pointer;
}

label {
    display: block;
    margin-top: 16px;
    font-size: 16px;
    font-weight: 500;
}

input, select, button {
    width: 100%;
    padding: 14px 16px;
    border-radius: 14px;
    border: 1px solid #ddd;
    margin-top: 6px;
    font-size: 16px;
}

button {
    border: none;
    cursor: pointer;
    background: var(--pink);
    color: var(--white);
    transition: transform 0.15s ease, box-shadow 0.15s ease;
}

button:hover {
    background: var(--pink-dark);
    transform: translateY(-1px);
    box-shadow: 0 6px 14px rgba(233,30,99,0.3);
}

.task {
    background: var(--white);
    padding: 20px;
    margin-bottom: 16px;
    border-radius: 18px;
    box-shadow: 0 10px 30px rgba(233,30,99,0.18);
    position: relative;
    overflow: hidden;
    touch-action: pan-y;
}

.task + .task {
    margin-top: 8px; /* spacing between tasks if needed */
}

.task-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
    margin-bottom: 12px; /* spacing below header */
}

.task-title {
    font-weight: 600;
    font-size: 18px;
    line-height: 1.3;
}

.price {
    font-size: 15px;
    color: #666;
    margin-bottom: 12px; /* spacing below reward */
}

.task-actions {
    display: flex;
    gap: 12px;
    align-items: center;
    flex-wrap: wrap;
    margin-top: 12px;
}

.complete-btn {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: var(--pink-light);
    color: var(--pink-dark);
    font-size: 24px;
    font-weight: bold;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.complete-btn.completed {
    background: var(--pink);
    color: var(--white);
}

.counter {
    font-weight: 600;
    font-size: 16px;
}

.celebrate {
    animation: pop 0.6s ease-out;
}

@keyframes pop {
    0% { transform: scale(0.95); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
}

.confetti {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.confetti span {
    position: absolute;
    font-size: 22px;
    animation: float 1.2s ease-out forwards;
}

@keyframes float {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
}
</style>
</head>
<body>

<h1>Sumsimausi Habit Tracker</h1>

<div class="task-form" id="taskForm">
    <h3 onclick="toggleForm()">âž• Create New Task</h3>

    <div id="formContent">
        <label>
            Task Name
            <input type="text" id="taskName">
        </label>

        <label>
            Reward / Price (text only)
            <input type="text" id="taskPrice" placeholder="">
        </label>

        <label>
            Task Type
            <select id="taskType">
                <option value="binary">Completed / Not completed</option>
                <option value="counter">Counter (X times in a row)</option>
            </select>
        </label>

        <label id="targetWrapper" style="display:none;">
            Target Count
            <input type="number" id="taskTarget" min="1" value="1">
        </label>

        <button onclick="addTask()" style="margin-top:20px;">Add Task</button>
    </div>
</div>

<div id="taskList"></div>

<script>
const taskList = document.getElementById("taskList");
const taskTypeSelect = document.getElementById("taskType");
const targetWrapper = document.getElementById("targetWrapper");
const taskForm = document.getElementById("taskForm");

taskTypeSelect.addEventListener("change", () => {
    targetWrapper.style.display = taskTypeSelect.value === "counter" ? "block" : "none";
});

function toggleForm() {
    taskForm.classList.toggle("expanded");
}

let tasks = JSON.parse(localStorage.getItem("tasks")) || [];

function saveTasks() {
    localStorage.setItem("tasks", JSON.stringify(tasks));
}

function addTask() {
    const name = taskName.value.trim();
    const price = taskPrice.value.trim();
    const type = taskTypeSelect.value;
    const target = parseInt(taskTarget.value, 10);

    if (!name) return;

    tasks.push({
        id: Date.now(),
        name,
        price,
        type,
        completed: false,
        count: 0,
        target: type === "counter" ? target : null
    });

    saveTasks();
    renderTasks();
    taskName.value = "";
    taskPrice.value = "";
    taskForm.classList.remove("expanded");
}

function celebrate(element) {
    element.classList.add("celebrate");

    const confetti = document.createElement("div");
    confetti.className = "confetti";

    for (let i = 0; i < 8; i++) {
        const span = document.createElement("span");
        span.textContent = "ðŸ’–";
        span.style.left = Math.random() * 100 + "%";
        span.style.top = "60%";
        confetti.appendChild(span);
    }

    element.appendChild(confetti);
    setTimeout(() => confetti.remove(), 1200);
}

function toggleComplete(id, el) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;

    task.completed = !task.completed;
    saveTasks();
    renderTasks();

    if (task.completed) celebrate(el.closest(".task"));
}

function incrementCounter(id, el) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;

    if(task.count < task.target) task.count++;
    if (task.count >= task.target && !task.completed) {
        task.completed = true;
        celebrate(el.closest(".task"));
    }

    saveTasks();
    renderTasks();
}

function resetCounter(id) {
    const task = tasks.find(t => t.id === id);
    if (!task) return;

    task.count = 0;
    task.completed = false;
    saveTasks();
    renderTasks();
}

function deleteTask(id) {
    tasks = tasks.filter(t => t.id !== id);
    saveTasks();
    renderTasks();
}

function renderTasks() {
    taskList.innerHTML = "";

    const sorted = [...tasks].sort((a, b) => Number(a.completed) - Number(b.completed));

    sorted.forEach(task => {
        const div = document.createElement("div");
        div.className = "task";
        div.dataset.id = task.id;

        let startX = 0;
        let currentX = 0;
        let threshold = 80;
        let isSwiping = false;

        div.addEventListener("touchstart", e => {
            startX = e.touches[0].clientX;
        });

        div.addEventListener("touchmove", e => {
            currentX = e.touches[0].clientX - startX;
            if(Math.abs(currentX) > 10) {
                isSwiping = true;
                div.style.transform = `translateX(${currentX}px)`;
            }
        });

        div.addEventListener("touchend", () => {
            if (isSwiping && Math.abs(currentX) > threshold) {
                deleteTask(task.id);
            } else {
                div.style.transform = "translateX(0)";
            }
            isSwiping = false;
            currentX = 0;
        });

        const header = document.createElement("div");
        header.className = "task-header";

        const title = document.createElement("div");
        title.className = "task-title";
        title.textContent = task.name;

        const completeBtn = document.createElement("button");
        completeBtn.className = "complete-btn" + (task.completed ? " completed" : "");
        completeBtn.innerHTML = task.completed ? "âœ“" : "";
        completeBtn.onclick = (e) => toggleComplete(task.id, e.target);

        header.appendChild(title);
        header.appendChild(completeBtn);
        div.appendChild(header);

        if (task.price) {
            const price = document.createElement("div");
            price.className = "price";
            price.textContent = "Reward: " + task.price;
            div.appendChild(price);
        }

        const actions = document.createElement("div");
        actions.className = "task-actions";

        if (task.type === "counter") {
            const counter = document.createElement("span");
            counter.className = "counter";
            counter.textContent = `Progress: ${task.count} / ${task.target}`;
            actions.appendChild(counter);

            const incBtn = document.createElement("button");
            incBtn.textContent = "+1";
            incBtn.onclick = (e) => incrementCounter(task.id, e.target);
            actions.appendChild(incBtn);

            const resetBtn = document.createElement("button");
            resetBtn.textContent = "Reset";
            resetBtn.onclick = () => resetCounter(task.id);
            actions.appendChild(resetBtn);
        }

        div.appendChild(actions);
        taskList.appendChild(div);
    });
}

renderTasks();
</script>

</body>
</html>
